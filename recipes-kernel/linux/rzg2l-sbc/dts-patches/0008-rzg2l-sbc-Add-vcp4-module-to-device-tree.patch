From 694349f02c3b1fd54abc5a72f7a789a70401a50c Mon Sep 17 00:00:00 2001
From: Khanh Do Duy <khanh.do.yg@bp.renesas.com>
Date: Tue, 10 Dec 2024 08:49:30 +0000
Subject: [PATCH 2/2] rzg2l-sbc: Add vcp4 module to device tree
Upstream-Status: Pending
---
 arch/arm64/boot/dts/renesas/r9a07g044.dtsi | 41 ++++++++++++++++++++++
 drivers/clk/renesas/r9a07g044-cpg.c        | 14 +++++++-
 kernel/exit.c                              |  1 +
 3 files changed, 55 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/boot/dts/renesas/r9a07g044.dtsi b/arch/arm64/boot/dts/renesas/r9a07g044.dtsi
index 2069ecc15117..22103cc6d8ed 100644
--- a/arch/arm64/boot/dts/renesas/r9a07g044.dtsi
+++ b/arch/arm64/boot/dts/renesas/r9a07g044.dtsi
@@ -571,6 +571,47 @@ channel1 {
 			};
 		};
 
+		fcpcs: vcp4@10820000 {
+			compatible = "renesas,vcp4-fcpcs";
+			reg = <0 0x10820000 0 0x200>;
+			renesas,#ch = <0>;
+		};
+
+		vcpl4: vcp4@10800000 {
+			compatible = "renesas,vcp4-vcpl4";
+			reg = <0 0x10800000 0 0x200>, <0 0x10810200 0 0x200>;
+			interrupt-names = "vcp0", "vcp1";
+			interrupts = <GIC_SPI 161 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 162 IRQ_TYPE_LEVEL_HIGH>;
+			clocks = <&cpg CPG_MOD R9A07G044_H264_CLK_A>,
+				<&cpg CPG_MOD R9A07G044_H264_CLK_P>;
+			power-domains = <&cpg>;
+			resets = <&cpg R9A07G044_H264_X_RESET_VCP>,
+				<&cpg R9A07G044_H264_CP_PRESET_P>;
+			renesas,#ch = <0>;
+			renesas,#fcp_ch = <0>;
+		};
+
+		isu: isum@10840000 {
+			compatible = "renesas,isum";
+			reg = <0 0x10840000 0 0x01F4>;
+			interrupts = <GIC_SPI 157 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 158 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 159 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 160 IRQ_TYPE_LEVEL_HIGH>;
+			clocks = <&cpg CPG_MOD R9A07G044_ISU_ACLK>,
+				<&cpg CPG_MOD R9A07G044_ISU_PCLK>;
+			clock-names = "isu_aclk", "isu_pclk";
+			resets = <&cpg R9A07G044_ISU_ARESETN>,
+				<&cpg R9A07G044_ISU_PRESETN>;
+			reset-names = "aresetn", "presetn";
+			renesas,#ch = <0>;
+			renesas,#rpf = <1>;
+			renesas,#wpf = <1>;
+			renesas,has-rs;
+			power-domains = <&cpg>;
+		};
+
 		i2c0: i2c@10058000 {
 			#address-cells = <1>;
 			#size-cells = <0>;
diff --git a/drivers/clk/renesas/r9a07g044-cpg.c b/drivers/clk/renesas/r9a07g044-cpg.c
index f6df3f7a31b5..8fd9a72071d7 100644
--- a/drivers/clk/renesas/r9a07g044-cpg.c
+++ b/drivers/clk/renesas/r9a07g044-cpg.c
@@ -197,7 +197,7 @@ static const struct {
 };
 
 static const struct {
-	struct rzg2l_mod_clk common[81];
+	struct rzg2l_mod_clk common[85];
 #ifdef CONFIG_CLK_R9A07G054
 	struct rzg2l_mod_clk drp[0];
 #endif
@@ -269,6 +269,14 @@ static const struct {
 					0x558, 1),
 		DEF_MOD("gpu_ace_clk",	R9A07G044_GPU_ACE_CLK, R9A07G044_CLK_P1,
 					0x558, 2),
+		DEF_MOD("isu_aclk",	R9A07G044_ISU_ACLK, R9A07G044_CLK_P1,
+					0x55C, 0),
+		DEF_MOD("isu_pclk",	R9A07G044_ISU_PCLK, R9A07G044_CLK_P2,
+					0x55C, 1),
+		DEF_MOD("h264_clk_a",	R9A07G044_H264_CLK_A, R9A07G044_CLK_M0,
+					0x560, 0),
+		DEF_MOD("h264_clk_p",	R9A07G044_H264_CLK_P, R9A07G044_CLK_ZT,
+					0x560, 0),
 		DEF_MOD("cru_sysclk",   R9A07G044_CRU_SYSCLK, CLK_M2_DIV2,
 					0x564, 0),
 		DEF_MOD("cru_vclk",     R9A07G044_CRU_VCLK, R9A07G044_CLK_M2,
@@ -396,6 +404,10 @@ static const struct rzg2l_reset r9a07g044_resets[] = {
 	DEF_RST(R9A07G044_GPU_RESETN, 0x858, 0),
 	DEF_RST(R9A07G044_GPU_AXI_RESETN, 0x858, 1),
 	DEF_RST(R9A07G044_GPU_ACE_RESETN, 0x858, 2),
+	DEF_RST(R9A07G044_ISU_ARESETN, 0x85C, 0),
+	DEF_RST(R9A07G044_ISU_PRESETN, 0x85C, 1),
+	DEF_RST(R9A07G044_H264_X_RESET_VCP, 0x860, 0),
+	DEF_RST(R9A07G044_H264_CP_PRESET_P, 0x860, 1),
 	DEF_RST(R9A07G044_CRU_CMN_RSTB, 0x864, 0),
 	DEF_RST(R9A07G044_CRU_PRESETN, 0x864, 1),
 	DEF_RST(R9A07G044_CRU_ARESETN, 0x864, 2),
-- 
2.25.1

